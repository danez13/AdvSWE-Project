name: PR Checks

on:
    pull_request:
        types: [opened, synchronize, reopened, ready_for_review]
    push:
        branches: [main]

concurrency:
    group: pr-${{ github.ref }}
    cancel-in-progress: true

jobs:
    quality:
        if: github.event.pull_request.draft == false
        runs-on: ubuntu-latest

        env:
            CI: true
            NEXT_TELEMETRY_DISABLED: '1'
            NODE_ENV: production

        steps:
            - name: Checkout
              uses: actions/checkout@v4

            - name: Setup Bun
              uses: oven-sh/setup-bun@v1
              with:
                  bun-version: 1.2.23

            - name: Install dependencies
              run: bun install --no-progress

            - name: ESLint
              run: bunx eslint . --max-warnings=0

            - name: TypeScript (no emit)
              run: bunx tsc -p tsconfig.json --noEmit

            - name: Build (Next.js)
              run: bun run build
